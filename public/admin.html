<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ú–∞–≥–∞–∑–∏–Ω —Ü–µ–º–µ–Ω—Ç–∞</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .login-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #2b6cb0, #1e3a8a);
            display: grid;
            place-items: center;
            z-index: 9999;
        }
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }
        .login-card h2 {
            margin: 0 0 10px 0;
            color: #2b6cb0;
        }
        .login-card .subtitle {
            color: #6b7280;
            margin-bottom: 30px;
        }
        .login-card input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }
        .login-card input:focus {
            outline: none;
            border-color: #2b6cb0;
        }
        .login-card .error {
            color: #e53e3e;
            font-size: 14px;
            margin-bottom: 15px;
            min-height: 20px;
        }
        .login-card button {
            width: 100%;
            padding: 12px;
            background: #2b6cb0;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        .login-card button:hover {
            background: #1e3a8a;
        }
        .admin-content {
            display: none;
        }
        .admin-content.authenticated {
            display: block;
        }
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2b6cb0;
        }
        .admin-actions {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .filters {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .order-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-left: 4px solid #2b6cb0;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .order-items {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .status-new { border-left-color: #2b6cb0; }
        .status-processing { border-left-color: #ecc94b; }
        .status-completed { border-left-color: #38a169; }
        .status-cancelled { border-left-color: #e53e3e; }
        .badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-new { background: #bee3f8; color: #2b6cb0; }
        .badge-processing { background: #fefcbf; color: #d69e2e; }
        .badge-completed { background: #c6f6d5; color: #276749; }
        .badge-cancelled { background: #fed7d7; color: #c53030; }
        .search-box {
            flex: 1;
            min-width: 200px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .form-row input {
            flex: 1;
        }
        .product-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        @media (max-width: 768px) {
            .filters, .admin-actions {
                flex-direction: column;
                align-items: stretch;
            }
            .order-header {
                flex-direction: column;
                align-items: flex-start;
            }
            .order-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div class="login-screen" id="login-screen">
        <div class="login-card">
            <h2>üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
            <p class="subtitle">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</p>
            <input 
                type="password" 
                id="admin-password" 
                placeholder="–ü–∞—Ä–æ–ª—å" 
                maxlength="4"
                autocomplete="off"
                onkeypress="if(event.key==='Enter') checkPassword()"
            />
            <div class="error" id="login-error"></div>
            <button onclick="checkPassword()">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
    <div class="admin-content" id="admin-content">
    <header>
        <div class="brand">
            <div class="logo">–ê</div>
            <div>
                <h1>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å - –ú–∞–≥–∞–∑–∏–Ω —Ü–µ–º–µ–Ω—Ç–∞</h1>
                <div class="muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            </div>
        </div>
        <div class="controls">
            <button class="btn secondary" onclick="location.href='/'">–ù–∞ —Å–∞–π—Ç</button>
            <button class="btn secondary" onclick="showProductsSection()">–¢–æ–≤–∞—Ä—ã</button>
            <button class="btn" onclick="exportOrders()">–≠–∫—Å–ø–æ—Ä—Ç</button>
            <button class="btn" onclick="showAddOrderModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
            <button class="btn secondary" onclick="logout()" style="background: #e53e3e; color: white; border: none;">üîì –í—ã–π—Ç–∏</button>
        </div>
    </header>

    <div class="admin-container">
        <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –∑–∞–∫–∞–∑–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏ -->
        <div style="margin-bottom: 20px;">
            <button class="btn" id="orders-tab" onclick="showOrdersSection()">–ó–∞–∫–∞–∑—ã</button>
            <button class="btn secondary" id="products-tab" onclick="showProductsSection()">–¢–æ–≤–∞—Ä—ã</button>
            <button class="btn secondary" id="categories-tab" onclick="showCategoriesSection()">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ -->
        <div id="orders-section">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-orders">0</div>
                <div class="muted">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-revenue">0 ‚Ç∏</div>
                <div class="muted">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="new-orders">0</div>
                <div class="muted">–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-order">0 ‚Ç∏</div>
                <div class="muted">–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</div>
            </div>
        </div>

        <!-- –î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="admin-actions">
            <button class="btn secondary" onclick="loadOrders()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            <button class="btn secondary" onclick="clearFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <div class="filters">
            <div class="search-box">
                <input type="text" id="search-orders" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É..." style="width: 100%;">
            </div>
            <select id="status-filter" style="padding: 8px; border-radius: 6px; border: 1px solid #e5e7eb;">
                <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                <option value="new">–ù–æ–≤—ã–µ</option>
                <option value="processing">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</option>
                <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</option>
            </select>
            <input type="date" id="date-from" style="padding: 8px; border-radius: 6px; border: 1px solid #e5e7eb;">
            <input type="date" id="date-to" style="padding: 8px; border-radius: 6px; border: 1px solid #e5e7eb;">
        </div>

        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
        <div id="orders-list">
            <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</div>
        </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
        <div id="products-section" style="display: none;">
            <div class="admin-actions">
                <button class="btn" onclick="showAddProductModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                <button class="btn" onclick="showImportModal()">üìÅ –ò–º–ø–æ—Ä—Ç –∏–∑ Excel</button>
                <button class="btn secondary" onclick="downloadTemplate()">üìÑ –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω</button>
                <button class="btn secondary" onclick="loadProducts()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
            <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <label style="font-weight: bold; margin-bottom: 8px; display: block;">–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
                <select id="category-filter-admin" onchange="filterProductsByCategory()" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #e5e7eb;">
                    <option value="">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>
                </select>
            </div>

            <!-- –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤ -->
            <div style="background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <label style="font-weight: bold; margin-bottom: 8px; display: block;">üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤:</label>
                <input type="search" id="search-products" oninput="searchProducts()" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..." style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #e5e7eb; font-size: 14px;">
            </div>

            <div id="products-list">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
        <div id="categories-section" style="display: none;">
            <div class="admin-actions">
                <button class="btn" onclick="showAddCategoryModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button class="btn secondary" onclick="loadCategories()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <div id="categories-list-admin">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ -->
    <div id="product-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <h3 id="product-modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                <input type="text" id="product-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 450" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="product-category" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>–¶–µ–Ω–∞ (‚Ç∏) *</label>
                <input type="number" id="product-price" placeholder="2000" min="0" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                <input type="text" id="product-image" placeholder="/assets/cement.jpg" style="width: 100%; margin-bottom: 10px;">
                <div style="margin-top: 10px;">
                    <label style="display: inline-block; cursor: pointer; background: #f3f4f6; padding: 8px 12px; border-radius: 6px; border: 1px solid #e5e7eb;">
                        üìÅ –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        <input type="file" id="product-image-file" accept="image/*" style="display: none;" onchange="uploadProductImage(this)">
                    </label>
                    <div id="upload-status" style="margin-top: 5px; font-size: 13px; color: #6b7280;"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label>–í –Ω–∞–ª–∏—á–∏–∏</label>
                <select id="product-stock" style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #e5e7eb;">
                    <option value="1">–î–∞</option>
                    <option value="0">–ù–µ—Ç</option>
                </select>
            </div>
            
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeProductModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn" onclick="saveProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
    <div id="category-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 450px;">
            <h3 id="category-modal-title">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
            
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                <input type="text" id="category-name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¶–ï–ú–ï–ù–¢" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)</label>
                <input type="text" id="category-icon" placeholder="üì¶" maxlength="2" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>–ü–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                <input type="number" id="category-order" placeholder="0" min="0" style="width: 100%;">
            </div>
            
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeCategoryModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn" onclick="saveCategory()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div id="import-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 550px;">
            <h3>üìÅ –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Excel</h3>
            <p class="muted" style="margin-bottom: 15px;">
                –ó–∞–≥—Ä—É–∑–∏—Ç–µ Excel —Ñ–∞–π–ª (.xlsx) —Å —Ç–æ–≤–∞—Ä–∞–º–∏. 
                <a href="#" onclick="downloadTemplate(); return false;" style="color: var(--accent);">–°–∫–∞—á–∞–π—Ç–µ —à–∞–±–ª–æ–Ω</a> –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞.
            </p>
            
            <div class="form-group">
                <label>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞:</label>
                <ul style="margin: 5px 0; padding-left: 20px; font-size: 13px; color: #6b7280;">
                    <li><strong>–ù–∞–∑–≤–∞–Ω–∏–µ</strong> - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</li>
                    <li><strong>–¶–µ–Ω–∞</strong> - —Ü–µ–Ω–∞ –≤ —Ç–µ–Ω–≥–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</li>
                    <li><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</strong> - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
                    <li><strong>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</strong> - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</li>
                    <li><strong>–í_–Ω–∞–ª–∏—á–∏–∏</strong> - –¥–∞/–Ω–µ—Ç</li>
                </ul>
            </div>
            
            <div class="form-group">
                <label style="display: block; cursor: pointer; background: #f3f4f6; padding: 20px; border-radius: 8px; border: 2px dashed #e5e7eb; text-align: center;">
                    üìÇ –í—ã–±–µ—Ä–∏—Ç–µ Excel —Ñ–∞–π–ª
                    <input type="file" id="import-file" accept=".xlsx,.xls" style="display: none;" onchange="handleImportFile(this)">
                </label>
                <div id="import-file-name" style="margin-top: 10px; font-size: 13px; color: #6b7280;"></div>
            </div>
            
            <div id="import-progress" style="display: none; margin: 15px 0;">
                <div style="background: #f3f4f6; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div id="import-progress-bar" style="background: var(--accent); height: 100%; width: 0%; transition: width 0.3s;"></div>
                </div>
                <div id="import-status" style="margin-top: 8px; font-size: 13px; color: #6b7280;"></div>
            </div>
            
            <div id="import-result" style="display: none; margin: 15px 0; padding: 12px; border-radius: 8px;"></div>
            
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeImportModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn" id="import-btn" onclick="importProducts()" disabled>–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ -->
    <div id="status-modal" class="modal" style="display: none;">
        <div class="modal-card">
            <h3>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞</h3>
            <p>–ó–∞–∫–∞–∑ #<span id="modal-order-id"></span></p>
            <select id="new-status" style="width: 100%; padding: 10px; margin: 10px 0; border-radius: 6px; border: 1px solid #e5e7eb;">
                <option value="new">–ù–æ–≤—ã–π</option>
                <option value="processing">–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</option>
                <option value="completed">–ó–∞–≤–µ—Ä—à–µ–Ω</option>
                <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω</option>
            </select>
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeStatusModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn" onclick="updateOrderStatus()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
    <div id="add-order-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 600px;">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
            
            <div class="form-group">
                <label>–ö–ª–∏–µ–Ω—Ç</label>
                <input type="text" id="new-order-name" placeholder="–§–ò–û –∫–ª–∏–µ–Ω—Ç–∞" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                <input type="text" id="new-order-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <input type="text" id="new-order-address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏" style="width: 100%;">
            </div>
            
            <div class="form-group">
                <label>–¢–æ–≤–∞—Ä—ã</label>
                <div id="new-order-items">
                    <div class="product-item">
                        <div class="form-row">
                            <select class="product-select" style="flex: 2;">
                                <option value="1">–¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 450 - 2,050 ‚Ç∏</option>
                                <option value="2">–¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 500 - 2,100 ‚Ç∏</option>
                                <option value="3">–¶–µ–º–µ–Ω—Ç –°—Ç–∞–Ω–¥–∞—Ä—Ç 450 - 2,000 ‚Ç∏</option>
                                <option value="4">–¶–µ–º–µ–Ω—Ç –ê–∫–∫–µ—Ä–º–∞–Ω - 2,200 ‚Ç∏</option>
                            </select>
                            <input type="number" class="product-qty" placeholder="–ö–æ–ª-–≤–æ" min="1" value="1" style="flex: 1;">
                            <button class="btn secondary" onclick="removeProductItem(this)">√ó</button>
                        </div>
                    </div>
                </div>
                <button class="btn secondary" onclick="addProductItem()" style="margin-top: 10px;">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            </div>
            
            <div class="form-group">
                <label>–ò—Ç–æ–≥–æ: <span id="new-order-total">0</span> ‚Ç∏</label>
            </div>
            
            <div class="modal-actions">
                <button class="btn secondary" onclick="closeAddOrderModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn" onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
            </div>
        </div>
    </div>

    <script>
        let allOrders = [];
        let currentEditingOrderId = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
        async function loadOrders() {
            try {
                document.getElementById('orders-list').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</div>';
                
                const response = await fetch('/api/orders');
                allOrders = await response.json();
                
                applyFilters();
                updateStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                document.getElementById('orders-list').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤</div>';
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function applyFilters() {
            const searchTerm = document.getElementById('search-orders').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;

            let filteredOrders = allOrders;

            // –ü–æ–∏—Å–∫
            if (searchTerm) {
                filteredOrders = filteredOrders.filter(order => 
                    order.name.toLowerCase().includes(searchTerm) ||
                    order.phone.includes(searchTerm) ||
                    order.address?.toLowerCase().includes(searchTerm)
                );
            }

            // –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
            if (statusFilter) {
                filteredOrders = filteredOrders.filter(order => order.status === statusFilter);
            }

            // –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ
            if (dateFrom) {
                filteredOrders = filteredOrders.filter(order => new Date(order.created_at) >= new Date(dateFrom));
            }
            if (dateTo) {
                const toDate = new Date(dateTo);
                toDate.setDate(toDate.getDate() + 1);
                filteredOrders = filteredOrders.filter(order => new Date(order.created_at) < toDate);
            }

            renderOrders(filteredOrders);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤
        function renderOrders(orders) {
            const container = document.getElementById('orders-list');
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="empty-state">–ó–∞–∫–∞–∑—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="order-card status-${order.status || 'new'}">
                    <div class="order-header">
                        <div>
                            <strong>–ó–∞–∫–∞–∑ #${order.id}</strong>
                            <span class="badge badge-${order.status || 'new'}">
                                ${getStatusText(order.status)}
                            </span>
                        </div>
                        <div class="muted">
                            ${new Date(order.created_at).toLocaleString('ru-RU')}
                        </div>
                    </div>
                    
                    <div><strong>üë§ ${order.name}</strong></div>
                    <div class="muted">üìû ${order.phone}</div>
                    ${order.address ? `<div class="muted">üè† ${order.address}</div>` : ''}
                    
                    <div class="order-items">
                        <strong>–¢–æ–≤–∞—Ä—ã:</strong>
                        ${Object.entries(order.items).map(([id, qty]) => `
                            <div class="order-item">
                                <span>${getProductName(parseInt(id))}</span>
                                <span>${qty} —à—Ç √ó ${getProductPrice(parseInt(id))} ‚Ç∏ = <strong>${(getProductPrice(parseInt(id)) * qty).toLocaleString('ru-RU')} ‚Ç∏</strong></span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: right; font-size: 1.2em; font-weight: bold; margin-top: 10px;">
                        –ò—Ç–æ–≥–æ: ${parseInt(order.total).toLocaleString('ru-RU')} ‚Ç∏
                    </div>
                    
                    <div class="order-actions">
                        <button class="btn secondary" onclick="changeStatus(${order.id})">
                            –°–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                        </button>
                        <button class="btn" onclick="callCustomer('${order.phone}')">
                            –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                        </button>
                        <button class="btn secondary" onclick="deleteOrder(${order.id})">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            const totalOrders = allOrders.length;
            const totalRevenue = allOrders.reduce((sum, order) => sum + parseInt(order.total), 0);
            const newOrders = allOrders.filter(order => !order.status || order.status === 'new').length;
            const avgOrder = totalOrders > 0 ? Math.round(totalRevenue / totalOrders) : 0;

            document.getElementById('total-orders').textContent = totalOrders;
            document.getElementById('total-revenue').textContent = totalRevenue.toLocaleString('ru-RU') + ' ‚Ç∏';
            document.getElementById('new-orders').textContent = newOrders;
            document.getElementById('avg-order').textContent = avgOrder.toLocaleString('ru-RU') + ' ‚Ç∏';
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getStatusText(status) {
            const statuses = {
                'new': '–ù–æ–≤—ã–π',
                'processing': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
            };
            return statuses[status] || '–ù–æ–≤—ã–π';
        }

        function getProductName(id) {
            const products = {
                1: '–¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 450',
                2: '–¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 500', 
                3: '–¶–µ–º–µ–Ω—Ç –°—Ç–∞–Ω–¥–∞—Ä—Ç 450',
                4: '–¶–µ–º–µ–Ω—Ç –ê–∫–∫–µ—Ä–º–∞–Ω'
            };
            return products[id] || `–¢–æ–≤–∞—Ä #${id}`;
        }

        function getProductPrice(id) {
            const prices = {1: 2050, 2: 2100, 3: 2000, 4: 2200};
            return prices[id] || 0;
        }

        // –î–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–∫–∞–∑–∞–º–∏
        function changeStatus(orderId) {
            currentEditingOrderId = orderId;
            document.getElementById('modal-order-id').textContent = orderId;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
            const order = allOrders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('new-status').value = order.status || 'new';
            }
            
            document.getElementById('status-modal').style.display = 'grid';
        }

        function closeStatusModal() {
            document.getElementById('status-modal').style.display = 'none';
            currentEditingOrderId = null;
        }

        async function updateOrderStatus() {
            const newStatus = document.getElementById('new-status').value;
            
            try {
                const response = await fetch(`/api/orders/${currentEditingOrderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.ok) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    const order = allOrders.find(o => o.id === currentEditingOrderId);
                    if (order) {
                        order.status = newStatus;
                        applyFilters();
                        updateStats();
                    }
                    closeStatusModal();
                    alert(`–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #${currentEditingOrderId} –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ "${getStatusText(newStatus)}"`);
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
            }
        }

        async function deleteOrder(orderId) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ #${orderId}?`)) return;
            
            try {
                const response = await fetch(`/api/orders/${orderId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    // –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                    allOrders = allOrders.filter(order => order.id !== orderId);
                    applyFilters();
                    updateStats();
                    alert(`–ó–∞–∫–∞–∑ #${orderId} —É–¥–∞–ª–µ–Ω`);
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
            }
        }

        function callCustomer(phone) {
            window.open(`tel:${phone}`, '_self');
        }

        function clearFilters() {
            document.getElementById('search-orders').value = '';
            document.getElementById('status-filter').value = '';
            document.getElementById('date-from').value = '';
            document.getElementById('date-to').value = '';
            applyFilters();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
        function showAddOrderModal() {
            document.getElementById('add-order-modal').style.display = 'grid';
            calculateNewOrderTotal();
        }

        function closeAddOrderModal() {
            document.getElementById('add-order-modal').style.display = 'none';
        }

        function addProductItem() {
            const container = document.getElementById('new-order-items');
            const newItem = document.createElement('div');
            newItem.className = 'product-item';
            newItem.innerHTML = `
                <div class="form-row">
                    <select class="product-select" style="flex: 2;" onchange="calculateNewOrderTotal()">
                        <option value="1">–¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 450 - 2,050 ‚Ç∏</option>
                        <option value="2">–¶–µ–º–µ–Ω—Ç –®—ã–º–∫–µ–Ω—Ç 500 - 2,100 ‚Ç∏</option>
                        <option value="3">–¶–µ–º–µ–Ω—Ç –°—Ç–∞–Ω–¥–∞—Ä—Ç 450 - 2,000 ‚Ç∏</option>
                        <option value="4">–¶–µ–º–µ–Ω—Ç –±—ã—Å—Ç—Ä–æ—Ç–≤–µ—Ä–¥–µ—é—â–∏–π - 12,500 ‚Ç∏</option>
                    </select>
                    <input type="number" class="product-qty" placeholder="–ö–æ–ª-–≤–æ" min="1" value="1" 
                           style="flex: 1;" onchange="calculateNewOrderTotal()">
                    <button class="btn secondary" onclick="removeProductItem(this)">√ó</button>
                </div>
            `;
            container.appendChild(newItem);
            calculateNewOrderTotal();
        }

        function removeProductItem(button) {
            if (document.querySelectorAll('.product-item').length > 1) {
                button.closest('.product-item').remove();
                calculateNewOrderTotal();
            }
        }

        function calculateNewOrderTotal() {
            let total = 0;
            document.querySelectorAll('.product-item').forEach(item => {
                const productId = item.querySelector('.product-select').value;
                const qty = parseInt(item.querySelector('.product-qty').value) || 0;
                total += getProductPrice(parseInt(productId)) * qty;
            });
            document.getElementById('new-order-total').textContent = total.toLocaleString('ru-RU');
        }

        async function createOrder() {
            const name = document.getElementById('new-order-name').value.trim();
            const phone = document.getElementById('new-order-phone').value.trim();
            const address = document.getElementById('new-order-address').value.trim();

            if (!name || !phone) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞');
                return;
            }

            // –°–æ–±–∏—Ä–∞–µ–º —Ç–æ–≤–∞—Ä—ã
            const items = {};
            document.querySelectorAll('.product-item').forEach(item => {
                const productId = item.querySelector('.product-select').value;
                const qty = parseInt(item.querySelector('.product-qty').value) || 0;
                if (qty > 0) {
                    items[productId] = qty;
                }
            });

            if (Object.keys(items).length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä');
                return;
            }

            const total = parseInt(document.getElementById('new-order-total').textContent.replace(/\s/g, '')) || 0;

            try {
                const response = await fetch('/api/admin/orders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name,
                        phone,
                        address,
                        items,
                        total
                    })
                });

                if (response.ok) {
                    alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!');
                    closeAddOrderModal();
                    loadOrders(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
                    
                    // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                    document.getElementById('new-order-name').value = '';
                    document.getElementById('new-order-phone').value = '';
                    document.getElementById('new-order-address').value = '';
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞');
            }
        }

        function exportOrders() {
            const csv = convertToCSV(allOrders);
            downloadCSV(csv, 'orders.csv');
        }

        function convertToCSV(orders) {
            const headers = ['ID', '–ò–º—è', '–¢–µ–ª–µ—Ñ–æ–Ω', '–ê–¥—Ä–µ—Å', '–¢–æ–≤–∞—Ä—ã', '–°—É–º–º–∞', '–î–∞—Ç–∞', '–°—Ç–∞—Ç—É—Å'];
            const rows = orders.map(order => [
                order.id,
                `"${order.name}"`,
                order.phone,
                `"${order.address || ''}"`,
                `"${Object.entries(order.items).map(([id, qty]) => `${getProductName(parseInt(id))} (${qty}—à—Ç)`).join(', ')}"`,
                order.total,
                new Date(order.created_at).toLocaleString('ru-RU'),
                getStatusText(order.status)
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // ============= –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–û–í–ê–†–ê–ú–ò =============
        let allProducts = [];
        let currentEditingProductId = null;
        let selectedCategoryId = '';

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤
        function showProductsSection() {
            document.getElementById('orders-section').style.display = 'none';
            document.getElementById('products-section').style.display = 'block';
            document.getElementById('categories-section').style.display = 'none';
            document.getElementById('orders-tab').className = 'btn secondary';
            document.getElementById('products-tab').className = 'btn';
            document.getElementById('categories-tab').className = 'btn secondary';
            loadProducts();
            loadCategoriesFilter(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –∑–∞–∫–∞–∑–æ–≤
        function showOrdersSection() {
            document.getElementById('orders-section').style.display = 'block';
            document.getElementById('products-section').style.display = 'none';
            document.getElementById('categories-section').style.display = 'none';
            document.getElementById('orders-tab').className = 'btn';
            document.getElementById('products-tab').className = 'btn secondary';
            document.getElementById('categories-tab').className = 'btn secondary';
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ñ–∏–ª—å—Ç—Ä
        async function loadCategoriesFilter() {
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();
                
                const select = document.getElementById('category-filter-admin');
                select.innerHTML = '<option value="">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</option>';
                
                categories.forEach(category => {
                    select.innerHTML += `<option value="${category.id}">${category.icon} ${category.name}</option>`;
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }

        // –§–∏–ª—å—Ç—Ä —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function filterProductsByCategory() {
            selectedCategoryId = document.getElementById('category-filter-admin').value;
            const searchQuery = document.getElementById('search-products').value.trim();
            renderProducts(selectedCategoryId, searchQuery);
        }

        // –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤
        function searchProducts() {
            const searchQuery = document.getElementById('search-products').value.trim();
            renderProducts(selectedCategoryId, searchQuery);
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
        async function loadProducts() {
            try {
                document.getElementById('products-list').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>';
                
                const response = await fetch('/api/products');
                allProducts = await response.json();
                
                renderProducts();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤:', error);
                document.getElementById('products-list').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>';
            }
        }

        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
        function renderProducts(categoryFilter = '', searchQuery = '') {
            const container = document.getElementById('products-list');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã
            let filteredProducts = allProducts;
            
            // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            if (categoryFilter) {
                filteredProducts = filteredProducts.filter(p => p.category_id == categoryFilter);
            }
            
            // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫—É
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(query) ||
                    p.id.toString().includes(query) ||
                    p.price.toString().includes(query)
                );
            }
            
            if (filteredProducts.length === 0) {
                container.innerHTML = '<div class="empty-state">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }

            container.innerHTML = filteredProducts.map(product => `
                <div class="order-card" style="border-left-color: ${product.stock ? '#38a169' : '#e53e3e'};">
                    <div class="order-header">
                        <div>
                            <h4 style="margin: 0 0 5px 0;">${product.name}</h4>
                            <div class="muted">ID: ${product.id} | –¶–µ–Ω–∞: ${product.price.toLocaleString('ru-RU')} ‚Ç∏</div>
                            ${product.image ? `<div class="muted">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${product.image}</div>` : ''}
                        </div>
                        <div>
                            <button class="badge ${product.stock ? 'badge-completed' : 'badge-cancelled'}" 
                                    onclick="toggleStock(${product.id}, ${product.stock})"
                                    style="cursor: pointer; border: none; transition: all 0.2s; background: ${product.stock ? '#c6f6d5' : '#fed7d7'}; color: ${product.stock ? '#276749' : '#9b2c2c'};"
                                    title="–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ª–∏—á–∏—è">
                                ${product.stock ? '‚úì –í –Ω–∞–ª–∏—á–∏–∏' : '‚úó –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
                            </button>
                        </div>
                    </div>
                    
                    <div class="order-actions">
                        <button class="btn secondary" onclick="editProduct(${product.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn secondary" onclick="deleteProduct(${product.id}, '${product.name}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        function showAddProductModal() {
            loadCategoriesForSelect(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–µ–ª–µ–∫—Ç
            currentEditingProductId = null;
            document.getElementById('product-modal-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
            document.getElementById('product-name').value = '';
            document.getElementById('product-category').value = '';
            document.getElementById('product-price').value = '';
            document.getElementById('product-image').value = '';
            document.getElementById('product-stock').value = '1';
            document.getElementById('product-modal').style.display = 'grid';
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
        async function editProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            currentEditingProductId = id;
            document.getElementById('product-modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-price').value = product.price;
            document.getElementById('product-image').value = product.image || '';
            document.getElementById('product-stock').value = product.stock ? '1' : '0';
            document.getElementById('product-modal').style.display = 'grid';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            await loadCategoriesForSelect();
            document.getElementById('product-category').value = product.category_id || '';
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä (—Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å)
        async function saveProduct() {
            const name = document.getElementById('product-name').value.trim();
            const category_id = document.getElementById('product-category').value || null;
            const price = parseInt(document.getElementById('product-price').value);
            const image = document.getElementById('product-image').value.trim();
            const stock = parseInt(document.getElementById('product-stock').value);

            if (!name || !price || price <= 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞');
                return;
            }

            const productData = { name, price, image, stock, category_id };

            try {
                let response;
                if (currentEditingProductId) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    response = await fetch(`/api/products/${currentEditingProductId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(productData)
                    });
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ
                    response = await fetch('/api/products', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(productData)
                    });
                }

                if (response.ok) {
                    alert(currentEditingProductId ? '–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!' : '–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
                    closeProductModal();
                    loadProducts();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞');
            }
        }

        // –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
        async function deleteProduct(id, name) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä "${name}"?`)) {
                return;
            }

            try {
                const response = await fetch(`/api/products/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω!');
                    loadProducts();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞');
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–∞
        async function toggleStock(id, currentStock) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            const newStock = currentStock ? 0 : 1;

            try {
                const response = await fetch(`/api/products/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: product.name,
                        price: product.price,
                        image: product.image,
                        stock: newStock,
                        category_id: product.category_id
                    })
                });

                if (response.ok) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    product.stock = newStock;
                    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
                    renderProducts(selectedCategoryId);
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞–ª–∏—á–∏—è');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞–ª–∏—á–∏—è');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ–≤–∞—Ä–∞
        function closeProductModal() {
            document.getElementById('product-modal').style.display = 'none';
            currentEditingProductId = null;
        }

        // ============= –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò =============
        let allCategoriesAdmin = [];
        let currentEditingCategoryId = null;

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function showCategoriesSection() {
            document.getElementById('orders-section').style.display = 'none';
            document.getElementById('products-section').style.display = 'none';
            document.getElementById('categories-section').style.display = 'block';
            document.getElementById('orders-tab').className = 'btn secondary';
            document.getElementById('products-tab').className = 'btn secondary';
            document.getElementById('categories-tab').className = 'btn';
            loadCategories();
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
        async function loadCategories() {
            try {
                document.getElementById('categories-list-admin').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</div>';
                
                const response = await fetch('/api/categories');
                allCategoriesAdmin = await response.json();
                
                renderCategoriesAdmin();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
                document.getElementById('categories-list-admin').innerHTML = '<div class="empty-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–µ–ª–µ–∫—Ç (–¥–ª—è —Ñ–æ—Ä–º—ã —Ç–æ–≤–∞—Ä–∞)
        async function loadCategoriesForSelect() {
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();
                
                const select = document.getElementById('product-category');
                select.innerHTML = '<option value="">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>';
                
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = `${cat.icon || 'üì¶'} ${cat.name}`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ
        function renderCategoriesAdmin() {
            const container = document.getElementById('categories-list-admin');
            
            if (allCategoriesAdmin.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é!</div>';
                return;
            }

            container.innerHTML = allCategoriesAdmin.map(category => `
                <div class="order-card" style="border-left-color: #2b6cb0;">
                    <div class="order-header">
                        <div>
                            <h4 style="margin: 0 0 5px 0;">${category.icon || 'üì¶'} ${category.name}</h4>
                            <div class="muted">ID: ${category.id} | –ü–æ—Ä—è–¥–æ–∫: ${category.order_index}</div>
                        </div>
                    </div>
                    
                    <div class="order-actions">
                        <button class="btn secondary" onclick="editCategory(${category.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        <button class="btn secondary" onclick="deleteCategory(${category.id}, '${category.name}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showAddCategoryModal() {
            currentEditingCategoryId = null;
            document.getElementById('category-modal-title').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
            document.getElementById('category-name').value = '';
            document.getElementById('category-icon').value = 'üì¶';
            document.getElementById('category-order').value = '0';
            document.getElementById('category-modal').style.display = 'grid';
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        function editCategory(id) {
            const category = allCategoriesAdmin.find(c => c.id === id);
            if (!category) return;

            currentEditingCategoryId = id;
            document.getElementById('category-modal-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
            document.getElementById('category-name').value = category.name;
            document.getElementById('category-icon').value = category.icon || 'üì¶';
            document.getElementById('category-order').value = category.order_index || 0;
            document.getElementById('category-modal').style.display = 'grid';
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é (—Å–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å)
        async function saveCategory() {
            const name = document.getElementById('category-name').value.trim();
            const icon = document.getElementById('category-icon').value.trim();
            const order_index = parseInt(document.getElementById('category-order').value) || 0;

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                return;
            }

            const categoryData = { name, icon: icon || 'üì¶', order_index, parent_id: null };

            try {
                let response;
                if (currentEditingCategoryId) {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                    response = await fetch(`/api/categories/${currentEditingCategoryId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(categoryData)
                    });
                } else {
                    // –°–æ–∑–¥–∞–Ω–∏–µ
                    response = await fetch('/api/categories', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(categoryData)
                    });
                }

                if (response.ok) {
                    alert(currentEditingCategoryId ? '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!' : '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
                    closeCategoryModal();
                    loadCategories();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
            }
        }

        // –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
        async function deleteCategory(id, name) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${name}"?\n\n–¢–æ–≤–∞—Ä—ã –∏–∑ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –±—É–¥—É—Ç –±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/categories/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞!');
                    loadCategories();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function closeCategoryModal() {
            document.getElementById('category-modal').style.display = 'none';
            currentEditingCategoryId = null;
        }

        // ============= –ò–ú–ü–û–†–¢ –¢–û–í–ê–†–û–í =============
        let selectedImportFile = null;

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞
        function showImportModal() {
            document.getElementById('import-modal').style.display = 'grid';
            document.getElementById('import-file-name').textContent = '';
            document.getElementById('import-progress').style.display = 'none';
            document.getElementById('import-result').style.display = 'none';
            document.getElementById('import-btn').disabled = true;
            selectedImportFile = null;
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞
        function closeImportModal() {
            document.getElementById('import-modal').style.display = 'none';
            selectedImportFile = null;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        function handleImportFile(input) {
            const file = input.files[0];
            if (!file) return;

            if (!file.name.endsWith('.xlsx') && !file.name.endsWith('.xls')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ Excel —Ñ–∞–π–ª (.xlsx –∏–ª–∏ .xls)');
                input.value = '';
                return;
            }

            selectedImportFile = file;
            document.getElementById('import-file-name').textContent = `–í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${file.name}`;
            document.getElementById('import-btn').disabled = false;
        }

        // –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
        async function importProducts() {
            if (!selectedImportFile) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                return;
            }

            const progressDiv = document.getElementById('import-progress');
            const progressBar = document.getElementById('import-progress-bar');
            const statusDiv = document.getElementById('import-status');
            const resultDiv = document.getElementById('import-result');
            const importBtn = document.getElementById('import-btn');

            progressDiv.style.display = 'block';
            resultDiv.style.display = 'none';
            importBtn.disabled = true;
            progressBar.style.width = '30%';
            statusDiv.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...';

            const formData = new FormData();
            formData.append('file', selectedImportFile);

            try {
                progressBar.style.width = '60%';
                statusDiv.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö...';

                const response = await fetch('/api/products/import', {
                    method: 'POST',
                    body: formData
                });

                progressBar.style.width = '100%';
                statusDiv.textContent = '–ó–∞–≤–µ—Ä—à–µ–Ω–æ!';

                const result = await response.json();

                if (response.ok) {
                    resultDiv.style.display = 'block';
                    resultDiv.style.background = '#d4edda';
                    resultDiv.style.color = '#155724';
                    
                    let message = `‚úì –£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: ${result.imported} –∏–∑ ${result.total} —Ç–æ–≤–∞—Ä–æ–≤`;
                    
                    if (result.errors && result.errors.length > 0) {
                        message += `\n\n–û—à–∏–±–∫–∏:\n${result.errors.join('\n')}`;
                    }
                    
                    resultDiv.innerHTML = message.replace(/\n/g, '<br>');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
                    setTimeout(() => {
                        loadProducts();
                    }, 1500);
                } else {
                    throw new Error(result.error || '–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
                
                resultDiv.style.display = 'block';
                resultDiv.style.background = '#f8d7da';
                resultDiv.style.color = '#721c24';
                resultDiv.textContent = `‚úó –û—à–∏–±–∫–∞: ${error.message}`;
                
                progressBar.style.width = '0%';
                statusDiv.textContent = '';
            } finally {
                importBtn.disabled = false;
            }
        }

        // –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω Excel
        function downloadTemplate() {
            window.open('/api/products/export-template', '_blank');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        async function uploadProductImage(input) {
            const file = input.files[0];
            if (!file) return;

            const statusDiv = document.getElementById('upload-status');
            statusDiv.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            statusDiv.style.color = '#2b6cb0';

            const formData = new FormData();
            formData.append('image', file);

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok && result.path) {
                    document.getElementById('product-image').value = result.path;
                    statusDiv.textContent = '‚úì –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
                    statusDiv.style.color = '#38a169';
                } else {
                    statusDiv.textContent = '‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                    statusDiv.style.color = '#e53e3e';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                statusDiv.textContent = '‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                statusDiv.style.color = '#e53e3e';
            }
        }

        // ============= –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =============
        const ADMIN_PASSWORD = '8888';
        const AUTH_KEY = 'adminAuthenticated';
        const AUTH_EXPIRY = 'adminAuthExpiry';

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkAuth() {
            const isAuth = localStorage.getItem(AUTH_KEY);
            const expiry = localStorage.getItem(AUTH_EXPIRY);
            const now = new Date().getTime();

            if (isAuth === 'true' && expiry && now < parseInt(expiry)) {
                // –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ —Å–µ—Å—Å–∏—è –Ω–µ –∏—Å—Ç–µ–∫–ª–∞
                showAdminPanel();
                return true;
            } else {
                // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏–ª–∏ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞
                localStorage.removeItem(AUTH_KEY);
                localStorage.removeItem(AUTH_EXPIRY);
                showLoginScreen();
                return false;
            }
        }

        function checkPassword() {
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('login-error');

            if (password === ADMIN_PASSWORD) {
                // –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
                const expiry = new Date().getTime() + (24 * 60 * 60 * 1000); // 24 —á–∞—Å–∞
                localStorage.setItem(AUTH_KEY, 'true');
                localStorage.setItem(AUTH_EXPIRY, expiry.toString());
                
                errorDiv.textContent = '‚úì –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!';
                errorDiv.style.color = '#38a169';
                
                setTimeout(() => {
                    showAdminPanel();
                }, 500);
            } else {
                // –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
                errorDiv.textContent = '‚úó –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                errorDiv.style.color = '#e53e3e';
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-password').focus();
                
                // –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏
                const card = document.querySelector('.login-card');
                card.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    card.style.animation = '';
                }, 500);
            }
        }

        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'grid';
            document.getElementById('admin-content').classList.remove('authenticated');
            document.getElementById('admin-password').focus();
        }

        function showAdminPanel() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-content').classList.add('authenticated');
        }

        function logout() {
            localStorage.removeItem(AUTH_KEY);
            localStorage.removeItem(AUTH_EXPIRY);
            showLoginScreen();
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Ç—Ä—è—Å–∫–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
                20%, 40%, 60%, 80% { transform: translateX(10px); }
            }
        `;
        document.head.appendChild(style);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (checkAuth()) {
                loadOrders();
            }
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(loadOrders, 30000);
            
            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.getElementById('search-orders').addEventListener('input', applyFilters);
            document.getElementById('status-filter').addEventListener('change', applyFilters);
            document.getElementById('date-from').addEventListener('change', applyFilters);
            document.getElementById('date-to').addEventListener('change', applyFilters);
        });
    </script>
    </div>
</body>
</html>